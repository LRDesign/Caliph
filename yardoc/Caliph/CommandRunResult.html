<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Caliph::CommandRunResult
  
    &mdash; caliph-0.1.2 Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Caliph/CommandRunResult.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Caliph.html" title="Caliph (module)">Caliph</a></span></span>
     &raquo; 
    <span class="title">CommandRunResult</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Caliph::CommandRunResult
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Caliph::CommandRunResult</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/caliph/command-run-result.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is the Caliph handle on a run process - it can be used to send signals
to running processes, wait for them to complete, get their exit status once
they have, and watch their streams in either case.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="MockCommandResult.html" title="Caliph::MockCommandResult (class)">MockCommandResult</a></span></p>
</div>




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#command-instance_method" title="#command (instance method)">- (Object) <strong>command</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute command.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#consume_timeout-instance_method" title="#consume_timeout (instance method)">- (Object) <strong>consume_timeout</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute consume_timeout.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pid-instance_method" title="#pid (instance method)">- (Object) <strong>pid</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute pid.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_status-instance_method" title="#process_status (instance method)">- (Object) <strong>process_status</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute process_status.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#streams-instance_method" title="#streams (instance method)">- (Object) <strong>streams</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute streams.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#consume_buffers-instance_method" title="#consume_buffers (instance method)">- (Object) <strong>consume_buffers</strong>(readable) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exit_code-instance_method" title="#exit_code (instance method)">- (exit_code<sup>?</sup>) <strong>exit_code</strong> </a>
    

    
      (also: #exit_status)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#format_streams-instance_method" title="#format_streams (instance method)">- (Object) <strong>format_streams</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Nicely formatted output of stdout and stderr - won&#39;t be intermixed,
which may be different than what you&#39;d see live in the shell.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (CommandRunResult) <strong>initialize</strong>(pid, command, shell) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of CommandRunResult.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#kill-instance_method" title="#kill (instance method)">- (Object) <strong>kill</strong>(signal = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stop a running process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#must_succeed%21-instance_method" title="#must_succeed! (instance method)">- (Object) <strong>must_succeed!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Demands that the process succeed, or else raises and error.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#running%3F-instance_method" title="#running? (instance method)">- (true, false) <strong>running?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check whether the process is still running.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stderr-instance_method" title="#stderr (instance method)">- (Object) <strong>stderr</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Access the stderr of the process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stdout-instance_method" title="#stdout (instance method)">- (Object) <strong>stdout</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Access the stdout of the process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#succeeded%3F-instance_method" title="#succeeded? (instance method)">- (Boolean) <strong>succeeded?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Confirm that the process exited with a successful exit code (i.e. 0).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wait-instance_method" title="#wait (instance method)">- (Object) <strong>wait</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Waits for the process to complete.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Caliph::CommandRunResult (class)">CommandRunResult</a></span></tt>) <strong>initialize</strong>(pid, command, shell) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of CommandRunResult</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8
9
10
11
12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 6</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_shell'>shell</span><span class='rparen'>)</span>
  <span class='ivar'>@command</span> <span class='op'>=</span> <span class='id identifier rubyid_command'>command</span>
  <span class='ivar'>@pid</span> <span class='op'>=</span> <span class='id identifier rubyid_pid'>pid</span>
  <span class='ivar'>@shell</span> <span class='op'>=</span> <span class='id identifier rubyid_shell'>shell</span>

  <span class='comment'>#####
</span>  <span class='ivar'>@process_status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@streams</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@consume_timeout</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="command-instance_method">
  
    - (<tt>Object</tt>) <strong>command</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute command</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_command'>command</span>
  <span class='ivar'>@command</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="consume_timeout=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="consume_timeout-instance_method">
  
    - (<tt>Object</tt>) <strong>consume_timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute consume_timeout</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_consume_timeout'>consume_timeout</span>
  <span class='ivar'>@consume_timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="pid-instance_method">
  
    - (<tt>Object</tt>) <strong>pid</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute pid</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pid'>pid</span>
  <span class='ivar'>@pid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="process_status-instance_method">
  
    - (<tt>Object</tt>) <strong>process_status</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute process_status</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_status'>process_status</span>
  <span class='ivar'>@process_status</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="streams=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="streams-instance_method">
  
    - (<tt>Object</tt>) <strong>streams</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute streams</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_streams'>streams</span>
  <span class='ivar'>@streams</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="consume_buffers-instance_method">
  
    - (<tt>Object</tt>) <strong>consume_buffers</strong>(readable) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_consume_buffers'>consume_buffers</span><span class='lparen'>(</span><span class='id identifier rubyid_readable'>readable</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span><span class='lparen'>(</span><span class='id identifier rubyid_readable'>readable</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_readable'>readable</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_readable'>readable</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='kw'>while</span> <span class='id identifier rubyid_chunk'>chunk</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='int'>4096</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='ivar'>@buffered_echo</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='ivar'>@shell</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='comma'>,</span> <span class='kw'>false</span>
          <span class='kw'>else</span>
            <span class='ivar'>@buffered_echo</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_chunk'>chunk</span>
          <span class='kw'>end</span>
          <span class='ivar'>@accumulators</span><span class='lbracket'>[</span><span class='id identifier rubyid_io'>io</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span>  <span class='id identifier rubyid_chunk'>chunk</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='kw'>rescue</span> <span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
        <span class='ivar'>@live_ioes</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="exit_code-instance_method">
  
    - (<tt>exit_code</tt><sup>?</sup>) <strong>exit_code</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='exit_status-instance_method'>exit_status</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>exit_code</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the raw exit of the process</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the process is still running</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exit_code'>exit_code</span>
  <span class='kw'>if</span> <span class='ivar'>@process_status</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='ivar'>@process_status</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="format_streams-instance_method">
  
    - (<tt>Object</tt>) <strong>format_streams</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Nicely formatted output of stdout and stderr - won&#39;t be intermixed,
which may be different than what you&#39;d see live in the shell</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_format_streams'>format_streams</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stdout:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[empty]\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stdout'>stdout</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stderr:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stderr'>stderr</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_stderr'>stderr</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[empty]\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stderr'>stderr</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>---</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="kill-instance_method">
  
    - (<tt>Object</tt>) <strong>kill</strong>(signal = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stop a running process. Sends SIGINT by default which about like hitting
Control-C.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>signal</span>
      
      
        <span class='type'></span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the Unix signal to send to the process</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_kill'>kill</span><span class='lparen'>(</span><span class='id identifier rubyid_signal'>signal</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span><span class='lparen'>(</span><span class='id identifier rubyid_signal'>signal</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INT</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ESRCH</span>
  <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Couldn&#39;t find process </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'> to kill it</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="must_succeed!-instance_method">
  
    - (<tt>Object</tt>) <strong>must_succeed!</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Demands that the process succeed, or else raises and error</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 68</span>

<span class='kw'>def</span> <span class='id identifier rubyid_must_succeed!'>must_succeed!</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_exit_code'>exit_code</span>
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_exit_code'>exit_code</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Command </span><span class='embexpr_beg'>#{</span><span class='ivar'>@command</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> failed with exit status </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exit_code'>exit_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>: \n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_streams'>format_streams</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="running?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>running?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check whether the process is still running</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the process is still running</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the process has completed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_running?'>running?</span>
  <span class='op'>!</span><span class='ivar'>@process_status</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stderr-instance_method">
  
    - (<tt>Object</tt>) <strong>stderr</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Access the stderr of the process</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stderr'>stderr</span>
  <span class='ivar'>@streams</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stdout-instance_method">
  
    - (<tt>Object</tt>) <strong>stdout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Access the stdout of the process</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stdout'>stdout</span>
  <span class='ivar'>@streams</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="succeeded?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>succeeded?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Confirm that the process exited with a successful exit code (i.e. 0). This
is pretty reliable, but many applications return bad exit statuses - 0 when
they failed, usually.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_succeeded?'>succeeded?</span>
  <span class='id identifier rubyid_must_succeed!'>must_succeed!</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>rescue</span>
  <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wait-instance_method">
  
    - (<tt>Object</tt>) <strong>wait</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Waits for the process to complete. If this takes longer that
consume_timeout, output on the process&#39;s streams will be output via
<span class='object_link'><a href="Shell.html#report-instance_method" title="Caliph::Shell#report (method)">Shell#report</a></span> - very useful when compilation or network transfers are
taking a long time.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/caliph/command-run-result.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wait'>wait</span>
  <span class='ivar'>@accumulators</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_waits'>waits</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@buffered_echo</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_ioes'>ioes</span> <span class='op'>=</span> <span class='id identifier rubyid_streams'>streams</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
  <span class='id identifier rubyid_ioes'>ioes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='ivar'>@accumulators</span><span class='lbracket'>[</span><span class='id identifier rubyid_io'>io</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_waits'>waits</span><span class='lbracket'>[</span><span class='id identifier rubyid_io'>io</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>3</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_begin_echoing'>begin_echoing</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='ivar'>@consume_timeout</span> <span class='op'>||</span> <span class='int'>3</span><span class='rparen'>)</span>

  <span class='ivar'>@live_ioes</span> <span class='op'>=</span> <span class='id identifier rubyid_ioes'>ioes</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='kw'>until</span> <span class='ivar'>@live_ioes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_newpid'>newpid</span><span class='comma'>,</span> <span class='ivar'>@process_status</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_waitpid2'>waitpid2</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='const'>Process</span><span class='op'>::</span><span class='const'>WNOHANG</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='ivar'>@process_status</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_consume_buffers'>consume_buffers</span><span class='lparen'>(</span><span class='ivar'>@live_ioes</span><span class='rparen'>)</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@buffered_echo</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_begin_echoing'>begin_echoing</span> <span class='op'>-</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>&lt;</span> <span class='int'>0</span>
        <span class='ivar'>@shell</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@shell</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Long running command output:</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@shell</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span> <span class='ivar'>@buffered_echo</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
        <span class='ivar'>@buffered_echo</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>IO</span><span class='op'>::</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='ivar'>@live_ioes</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@live_ioes</span><span class='comma'>,</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>IO</span><span class='op'>::</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='ivar'>@live_ioes</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@live_ioes</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'>#timeout
</span>      <span class='id identifier rubyid_readable'>readable</span><span class='comma'>,</span> <span class='id identifier rubyid__writeable'>_writeable</span><span class='comma'>,</span> <span class='id identifier rubyid_errored'>errored</span> <span class='op'>=</span> <span class='op'>*</span><span class='id identifier rubyid_result'>result</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_errored'>errored</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error on IO: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_errored'>errored</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_consume_buffers'>consume_buffers</span><span class='lparen'>(</span><span class='id identifier rubyid_readable'>readable</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@process_status</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_newpid'>newpid</span><span class='comma'>,</span> <span class='ivar'>@process_status</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_waitpid2'>waitpid2</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ioes'>ioes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
  <span class='ivar'>@streams</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_ioes'>ioes</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@accumulators</span><span class='lbracket'>[</span><span class='id identifier rubyid_io'>io</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jul 15 01:04:37 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.0.0).
</div>

  </body>
</html>